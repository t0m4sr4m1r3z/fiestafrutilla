<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fiesta Provincial de la Frutilla - Desmochado, Corrientes</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 5px;
            color: white;
            z-index: 10000;
            opacity: 0;
            transform: translateY(-20px);
            transition: opacity 0.3s, transform 0.3s;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .notification.success {
            background-color: #388e3c;
            opacity: 1;
            transform: translateY(0);
        }
        
        .notification.error {
            background-color: #d32f2f;
            opacity: 1;
            transform: translateY(0);
        }
        
        .form-status {
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            display: none;
        }
        
        .form-status.success {
            background-color: rgba(56, 142, 60, 0.1);
            border: 1px solid #388e3c;
            color: #1b5e20;
            display: block;
        }
        
        .form-status.error {
            background-color: rgba(211, 47, 47, 0.1);
            border: 1px solid #d32f2f;
            color: #b71c1c;
            display: block;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Estilo para el botón de diagnóstico */
        #debug-btn {
            position: fixed;
            bottom: 10px;
            right: 10px;
            padding: 8px 12px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            z-index: 1000;
            cursor: pointer;
            font-size: 12px;
        }

        /* Estilos profesionales para blogs tipo Bella Vista */
        .blogs-section {
            padding: 60px 0;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        }

        .blogs-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .blog-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid rgba(0,0,0,0.1);
        }

        .blog-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
        }

        .blog-image {
            width: 100%;
            height: 220px;
            object-fit: cover;
            border-bottom: 3px solid #667eea;
        }

        .blog-content {
            padding: 25px;
        }

        .blog-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: #2d3748;
            margin: 0 0 15px 0;
            line-height: 1.3;
        }

        .blog-excerpt {
            color: #718096;
            line-height: 1.6;
            margin: 0 0 20px 0;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .blog-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-top: 1px solid #e2e8f0;
            padding-top: 15px;
        }

        .blog-author {
            color: #667eea;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .blog-date {
            color: #a0aec0;
            font-size: 0.85rem;
        }

        .read-more {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            text-decoration: none;
            font-weight: 600;
            transition: background 0.3s ease;
            margin-top: 15px;
        }

        .read-more:hover {
            background: #5a67d8;
        }

        /* Header estilizado para blogs */
        .blogs-header {
            text-align: center;
            margin-bottom: 50px;
        }

        .blogs-header h2 {
            font-size: 2.5rem;
            color: #2d3748;
            margin: 0 0 15px 0;
            font-weight: 700;
        }

        .blogs-header p {
            font-size: 1.1rem;
            color: #718096;
            max-width: 600px;
            margin: 0 auto;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .blogs-container {
                grid-template-columns: 1fr;
                padding: 0 15px;
            }
            
            .blogs-header h2 {
                font-size: 2rem;
            }
            
            .blog-content {
                padding: 20px;
            }
        }

        /* Efecto de carga */
        .blog-card {
            animation: fadeInUp 0.6s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Badge para nuevos blogs */
        .new-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #48bb78;
            color: white;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
            z-index: 2;
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        /* Estilos para la sección "Acerca de" oculta inicialmente */
        #acerca {
            display: none;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        #acerca.visible {
            display: block;
            opacity: 1;
        }
    </style>
</head>

<body>
    <!-- Header -->
    <header>
        <div class="container header-content">
            <div class="logo">
                <i class="fas fa-strawberry fa-2x"></i>
                <h1>Fiesta de la Frutilla</h1>
            </div>
            <nav>
                <ul>
                    <li><a href="#inicio">INICIO</a></li>
                    <li><a href="#acerca">ACERCA DE</a></li>
                    <li><a href="historia.html">HISTORIA</a></li>
                    <li><a href="#noticias">NOTICIAS</a></li>
                    <li><a href="#ubicacion">UBICACIÓN</a></li>
                    <li><a href="productores.html">COMPRAR FRUTILLAS</a></li>
                    <li><a href="#contacto">CONTACTO</a></li>
                </ul>
            </nav>
            <button class="mobile-menu-btn">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero" id="inicio">
        <div class="container">
            <h2>Fiesta Provincial de la Frutilla</h2>
            <p>Celebramos la cultura y tradición de Desmochado, Corrientes, en honor a la deliciosa frutilla que caracteriza nuestra región.</p>
            <a href="#acerca" class="btn" id="conoce-mas-btn">Conoce más</a>
        </div>
    </section>

    <!-- About Section -->
    <section id="acerca">
        <div class="container">
            <div class="section-title">
                <h2>La Fiesta de la Frutilla</h2>
                <p>Un evento que celebra la tradición frutillera de Desmochado</p>
            </div>

            <div class="about-content">
                <div class="about-text">
                    <p>La "Fiesta de la Frutilla" es un evento que se celebra anualmente en el paraje Desmochado, ubicado en Bella Vista, Corrientes, y honra a los productores de esta fruta. La festividad incluye concursos de cosecha y despalillado, la elección de la Reina de la Frutilla, agasajos gastronómicos, y espectáculos musicales. Es una celebración clave para el desarrollo turístico y económico de la zona, que es considerada la región de mayor producción de frutillas del Nordeste argentino.</p>
                    
                    <h3>¿Cuándo se realiza?</h3>
                    <p>La fiesta se lleva a cabo a principios de octubre, coincidiendo con la época pico de producción y cosecha de la frutilla.</p>
                    
                    <h3>¿Qué se hace en la fiesta?</h3>
                    <ul>
                        <li><strong>Concursos:</strong> Se realizan competencias de cosecheros (quienes cosechan más en un tiempo determinado) y despalilladores (quienes quitan el tallo de las frutillas más rápidamente).</li>
                        <li><strong>Elección de la Reina:</strong> Se elige a la representante de la festividad.</li>
                        <li><strong>Espectáculos y Gastronomía:</strong> Hay música, se presentan diversos grupos y se ofrece comida basada en la frutilla.</li>
                        <li><strong>Homenaje a los productores:</strong> La fiesta es un reconocimiento al trabajo diario de los productores y la gran cantidad de personas que participan en el ciclo de la fruta.</li>
                    </ul>
                    
                    <h3>¿Por qué es importante para la región?</h3>
                    <ul>
                        <li><strong>Reconocimiento a la producción:</strong> Es un tributo a la principal actividad productiva de Desmochado, que es la frutilla.</li>
                        <li><strong>Desarrollo turístico:</strong> El evento atrae visitantes y ayuda a promocionar Bella Vista y Desmochado como destinos turísticos.</li>
                        <li><strong>Cultura e identidad:</strong> La fiesta refuerza la identidad cultural de la zona, conectando a la comunidad con sus tradiciones productivas.</li>
                    </ul>
                </div>
            </div>
        </div>
    </section>

    <!-- Sección de Blogs -->
    <section class="blogs-section" id="noticias">
        <div class="blogs-header">
            <h2>Últimas Noticias</h2>
            <p>Mantente informado sobre los eventos y novedades de la Fiesta de la Frutilla</p>
        </div>
        
        <div class="blogs-container" id="blogs-container">
            <!-- Los blogs se cargarán aquí dinámicamente -->
            <div class="blog-card" style="text-align: center; padding: 40px;">
                <div class="loading-spinner"></div>
                <p>Cargando noticias...</p>
            </div>
        </div>
    </section>

    <!-- Ubicación Section -->
    <section id="ubicacion" class="location-section">
        <div class="container">
            <div class="section-title">
                <h2>¿Cómo llegar a Desmochado?</h2>
                <p>Ubicación de la capital correntina de la frutilla</p>
            </div>

            <div class="location-content">
                <div class="location-info">
                    <h3>Desmochado, Bella Vista - Corrientes</h3>
                    <p>Desmochado es un paraje rural ubicado en el departamento de Bella Vista, provincia de Corrientes, Argentina. Es reconocido como la principal zona productora de frutillas de la región noreste del país.</p>
                    
                    <div class="location-details">
                        <div class="detail-item">
                            <i class="fas fa-map-marker-alt"></i>
                            <div>
                                <h4>Ubicación</h4>
                                <p>A 15 km de la ciudad de Bella Vista, Corrientes</p>
                            </div>
                        </div>
                        
                        <div class="detail-item">
                            <i class="fas fa-road"></i>
                            <div>
                                <h4>Accesos</h4>
                                <p>Ruta Provincial 27 y caminos rurales</p>
                            </div>
                        </div>
                        
                        <div class="detail-item">
                            <i class="fas fa-car"></i>
                            <div>
                                <h4>Desde Corrientes Capital</h4>
                                <p>Aproximadamente 120 km (1h 45min)</p>
                            </div>
                        </div>
                        
                        <div class="detail-item">
                            <i class="fas fa-bus"></i>
                            <div>
                                <h4>Transporte</h4>
                                <p>Servicios de colectivos hasta Bella Vista y luego transporte local</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="map-container">
                    <div class="map-wrapper">
                        <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d14220.435915996848!2d-58.88372283476563!3d-28.68559999999999!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x9450c16c982d536d%3A0x5b4b8b38f6c2c0b0!2sDesmochado%2C%20Corrientes!5e0!3m2!1ses!2sar!4v1663801399683!5m2!1ses!2sar" width="100%" height="100%" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer id="contacto">
        <div class="container">
            <div class="footer-content">
                <div class="footer-column">
                    <h3>Fiesta de la Frutilla</h3>
                    <p>Celebrando las tradiciones y la producción de frutillas de Desmochado, Corrientes, Argentina.</p>
                    <div class="social-links">
                        <a href="#"><i class="fab fa-facebook-f"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-youtube"></i></a>
                    </div>
                </div>
                <div class="footer-column">
                    <h3>Enlaces Rápidos</h3>
                    <ul>
                        <li><a href="#inicio"><i class="fas fa-arrow-right"></i> Inicio</a></li>
                        <li><a href="#historia"><i class="fas fa-arrow-right"></i> Historia</a></li>
                        <li><a href="#acerca"><i class="fas fa-arrow-right"></i> Acerca de</a></li>
                        <li><a href="#noticias"><i class="fas fa-arrow-right"></i> Noticias</a></li>
                        <li><a href="#ubicacion"><i class="fas fa-arrow-right"></i> Ubicación</a></li>
                        <li><a href="#compra"><i class="fas fa-arrow-right"></i> Comprar Frutillas</a></li>
                        <li><a href="#contacto"><i class="fas fa-arrow-right"></i> Contacto</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Contacto</h3>
                    <ul>
                        <li><a href="#"><i class="fas fa-map-marker-alt"></i> Desmochado, Bella Vista, Corrientes</a></li>
                        <li><a href="tel:+543794123456"><i class="fas fa-phone"></i> +54 3794-123456</a></li>
                        <li><a href="mailto:info@fiestafrutilla.com"><i class="fas fa-envelope"></i> info@fiestafrutilla.com</a></li>
                    </ul>
                </div>
            </div>
            <div class="copyright">
                <p>&copy; 2023 Fiesta Provincial de la Frutilla - Desmochado, Corrientes. Todos los derechos reservados.</p>
            </div>
        </div>
    </footer>
    
    <div id="notification" class="notification"></div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    <script>
        // URL de tu backend
        const API_URL = 'https://fiesta-frutilla-backend.onrender.com';

        // Función para mostrar/ocultar la sección "Acerca de"
        function toggleAcercaSection() {
            const acercaSection = document.getElementById('acerca');
            acercaSection.classList.toggle('visible');
            
            // Si se está mostrando, hacer scroll suave hacia la sección
            if (acercaSection.classList.contains('visible')) {
                window.scrollTo({
                    top: acercaSection.offsetTop - 80,
                    behavior: 'smooth'
                });
            }
        }

        // Función para verificar si el blog es nuevo (menos de 7 días)
        function isBlogNew(dateString) {
            const blogDate = new Date(dateString);
            const now = new Date();
            const diffTime = Math.abs(now - blogDate);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); 
            return diffDays <= 7;
        }
        
        // Función para formatear la fecha
        function formatDate(dateString) {
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            return new Date(dateString).toLocaleDateString('es-ES', options);
        }
        
        // Cargar blogs desde la API
        async function loadBlogs() {
    try {
        const response = await fetch('/.netlify/functions/get-blogs');
        const blogs = await response.json();
        
        const container = document.getElementById('blogs-container');
        
        if (blogs && blogs.length > 0) {
            container.innerHTML = blogs.map((blog, index) => {
                const isNew = blog.es_nuevo;
                const imageUrl = blog.imagen_url || 'https://images.unsplash.com/photo-1519996529934-ea4d5f6c055c?w=800&h=400&fit=crop';
                const blogUrl = `blog-dynamic.html?id=${blog.id}`;
                
                return `
                    <div class="blog-card">
                        ${isNew ? '<span class="new-badge">NUEVO</span>' : ''}
                        <img src="${imageUrl}" alt="${blog.titulo}" class="blog-image">
                        <div class="blog-content">
                            <h3 class="blog-title">${blog.titulo}</h3>
                            <p class="blog-excerpt">${blog.contenido.substring(0, 120)}...</p>
                            <a href="${blogUrl}" class="read-more">Leer más</a>
                            <div class="blog-meta">
                                <span class="blog-author">Por: ${blog.autor}</span>
                                <span class="blog-date">${formatDate(blog.fecha_publicacion)}</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        } else {
            container.innerHTML = `
                <div class="blog-card" style="text-align: center; padding: 40px;">
                    <h3 style="color: #718096; margin-bottom: 15px;">No hay noticias aún</h3>
                    <p style="color: #a0aec0;">Pronto publicaremos las últimas novedades de la Fiesta de la Frutilla</p>
                </div>
            `;
        }
    } catch (error) {
        console.error('Error cargando blogs:', error);
        container.innerHTML = `
            <div class="blog-card" style="text-align: center; padding: 40px;">
                <h3 style="color: #718096; margin-bottom: 15px;">Error cargando noticias</h3>
                <p style="color: #a0aec0;">Intenta recargar la página</p>
            </div>
        `;
    }
}

        document.addEventListener('DOMContentLoaded', function() {
            console.log('✅ Página cargada, verificando conexión con backend...');
            
            // Cargar blogs cuando la página se cargue
            loadBlogs();
            
            // Configurar el botón "Conoce más" para mostrar/ocultar la sección "Acerca de"
            const conoceMasBtn = document.getElementById('conoce-mas-btn');
            if (conoceMasBtn) {
                conoceMasBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    toggleAcercaSection();
                });
            }
            
            // Mobile Menu Toggle
            const mobileMenuBtn = document.querySelector('.mobile-menu-btn');
            const navMenu = document.querySelector('nav ul');
            const body = document.body;
            
            // Crear overlay para el menú
            const overlay = document.createElement('div');
            overlay.className = 'menu-overlay';
            document.body.appendChild(overlay);
            
            // Función para abrir el menú
            function openMenu() {
                navMenu.classList.add('show');
                overlay.classList.add('active');
                body.style.overflow = 'hidden';
            }
            
            // Función para cerrar el menú
            function closeMenu() {
                navMenu.classList.remove('show');
                overlay.classList.remove('active');
                body.style.overflow = '';
            }
            
            // Toggle menu al hacer clic en el botón
            if (mobileMenuBtn) {
                mobileMenuBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    if (navMenu.classList.contains('show')) {
                        closeMenu();
                    } else {
                        openMenu();
                    }
                });
            }
            
            // Cerrar menú al hacer clic en overlay
            overlay.addEventListener('click', closeMenu);
            
            // Cerrar menú al hacer clic en un enlace
            document.querySelectorAll('nav a').forEach(link => {
                link.addEventListener('click', closeMenu);
            });
            
            // Cerrar menú al redimensionar la ventana
            window.addEventListener('resize', function() {
                if (window.innerWidth > 768) {
                    closeMenu();
                }
            });
            
            // Smooth scrolling for navigation links
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    const targetId = this.getAttribute('href');
                    if (targetId === '#') return;
                    
                    const targetElement = document.querySelector(targetId);
                    if (targetElement) {
                        // Si es el enlace "Acerca de", asegurarse de que esté visible
                        if (targetId === '#acerca') {
                            if (!targetElement.classList.contains('visible')) {
                                toggleAcercaSection();
                            }
                        }
                        
                        window.scrollTo({
                            top: targetElement.offsetTop - 80,
                            behavior: 'smooth'
                        });
                        
                        history.pushState(null, null, targetId);
                    }
                });
            });
            
            // FUNCIÓN MEJORADA PARA ENVIAR PEDIDOS
            const orderForm = document.getElementById('order-form');
            if (orderForm) {
                orderForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    console.log('🔄 Iniciando envío de formulario...');
                    
                    // Obtener elementos del DOM
                    const btnText = document.getElementById('btn-text');
                    const btnLoading = document.getElementById('btn-loading');
                    const submitBtn = document.getElementById('submit-btn');
                    
                    // Mostrar estado de carga
                    if (btnText && btnLoading) {
                        btnText.style.display = 'none';
                        btnLoading.style.display = 'inline-block';
                    }
                    submitBtn.disabled = true;
                    
                    // Obtener valores del formulario
                    const name = document.getElementById('name').value;
                    const email = document.getElementById('email').value;
                    const phone = document.getElementById('phone').value;
                    const quantity = document.getElementById('quantity').value;
                    const address = document.getElementById('address').value;
                    const notes = document.getElementById('notes').value;
                    
                    // Validación
                    if (!name || !email || !phone || !quantity || quantity < 1 || !address) {
                        alert('Por favor, completa todos los campos obligatorios.');
                        
                        // Restaurar estado del botón
                        if (btnText && btnLoading) {
                            btnText.style.display = 'inline-block';
                            btnLoading.style.display = 'none';
                        }
                        submitBtn.disabled = false;
                        return;
                    }
                    
                    try {
                        // Crear objeto con los datos del pedido
                        const pedido = {
                            nombre: name,
                            email: email,
                            telefono: phone,
                            cantidad: parseInt(quantity),
                            direccion: address,
                            notas: notes || 'Sin notas adicionales',
                            fecha: new Date().toISOString(),
                            estado: 'pendiente'
                        };
                        
                        console.log('📤 Enviando pedido:', pedido);
                        
                        // Enviar a la base de datos
                        const response = await fetch(`${API_URL}/pedidos`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(pedido)
                        });
                        
                        console.log('📥 Respuesta del servidor:', response.status);
                        
                        if (response.ok) {
                            const responseData = await response.json();
                            console.log('✅ Pedido exitoso:', responseData);
                            
                            // Mostrar mensaje de éxito
                            alert('¡Pedido realizado con éxito! Te contactaremos pronto.');
                            
                            // Resetear formulario
                            orderForm.reset();
                            
                        } else {
                            console.error('❌ Error en respuesta:', response.status, response.statusText);
                            throw new Error(`Error del servidor: ${response.status} ${response.statusText}`);
                        }
                    } catch (error) {
                        console.error('❌ Error enviando pedido:', error);
                        alert('Error al enviar el pedido. Por favor, intenta nuevamente. Detalle: ' + error.message);
                    } finally {
                        // Restaurar estado del botón
                        if (btnText && btnLoading) {
                            btnText.style.display = 'inline-block';
                            btnLoading.style.display = 'none';
                        }
                        submitBtn.disabled = false;
                    }
                });
            }
        });
    </script>
</body>
</html>