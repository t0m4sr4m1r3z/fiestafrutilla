<script>
    // Verificar autenticación
    const token = localStorage.getItem('adminToken');
    if (!token) {
        window.location.href = '/admin.html';
    }
    
    let selectedImageFile = null;
    
    // Manejo de selección de imagen
    document.getElementById('blogImageFile').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            selectedImageFile = file;
            
            // Mostrar preview
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('previewImg').src = e.target.result;
                document.getElementById('previewImg').style.display = 'block';
                document.getElementById('upload-placeholder').style.display = 'none';
            }
            reader.readAsDataURL(file);
        }
    });
    
    function removeImage() {
        selectedImageFile = null;
        document.getElementById('blogImageFile').value = '';
        document.getElementById('previewImg').style.display = 'none';
        document.getElementById('upload-placeholder').style.display = 'block';
    }
    
    // Crear blog
    document.getElementById('createBlogForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        let imageUrl = '';
        
        // Subir imagen si hay una seleccionada
        if (selectedImageFile) {
            const uploadResult = await AdminConfig.uploadImage(selectedImageFile);
            if (uploadResult.success) {
                imageUrl = uploadResult.imageUrl;
            } else {
                alert('Error subiendo imagen: ' + uploadResult.error);
                return;
            }
        }
    
        const blogData = {
            titulo: document.getElementById('blogTitulo').value,
            contenido: document.getElementById('blogContenido').value,
            autor: document.getElementById('blogAutor').value,
            imagen_url: imageUrl
        };
    
        const result = await AdminConfig.createBlog(blogData);
        if (result.id) {
            alert('¡Blog creado exitosamente!');
            document.getElementById('createBlogForm').reset();
            removeImage();
            loadBlogs();
        } else {
            alert('Error: ' + (result.error || 'Error al crear blog'));
        }
    });
    
    // Cargar blogs al iniciar
    document.addEventListener('DOMContentLoaded', loadBlogs);
    </script>